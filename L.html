<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PasteLite — Minimal Pastebin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #0f1620;
      --panel-2: #121b26;
      --text: #e6edf3;
      --muted: #9fb0c0;
      --accent: #4cc2ff;
      --accent-2: #7af0b7;
      --danger: #ff6b6b;
      --ring: rgba(76, 194, 255, 0.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --round: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0; background: radial-gradient(1200px 800px at 10% -10%, #0c1a25 0%, #0b0f14 60%) no-repeat, var(--bg);
      color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.4;
    }
    a { color: var(--accent); text-decoration: none }
    a:hover { text-decoration: underline }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 28px 16px 64px }
    .header {
      display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 18px;
    }
    .brand { display: flex; align-items: center; gap: 10px; font-weight: 700; letter-spacing: .3px }
    .logo {
      width: 36px; height: 36px; border-radius: 12px; background: linear-gradient(135deg, var(--accent), var(--accent-2));
      display: grid; place-items: center; color: #061018; box-shadow: var(--shadow); font-weight: 900;
    }
    .muted { color: var(--muted); font-size: 14px }
    .card {
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border: 1px solid #1c2733; border-radius: var(--round); box-shadow: var(--shadow);
    }
    .toolbar {
      display: flex; flex-wrap: wrap; gap: 10px; padding: 14px; border-bottom: 1px solid #1c2733;
    }
    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap }
    .input, textarea {
      width: 100%; background: #0c131b; color: var(--text); border: 1px solid #1c2733; border-radius: 12px;
      padding: 10px 12px; outline: none; transition: border .2s, box-shadow .2s;
    }
    .input:focus, textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 4px var(--ring) }
    textarea {
      min-height: 360px; font-family: var(--mono); font-size: 14px; resize: vertical; border-radius: 0 0 var(--round) var(--round);
      border-top-left-radius: 0; border-top-right-radius: 0;
    }
    .btn {
      background: #0c131b; border: 1px solid #1c2733; color: var(--text); padding: 10px 14px; border-radius: 12px;
      cursor: pointer; transition: transform .04s ease, background .2s, border .2s;
    }
    .btn:hover { background: #0e1721; border-color: #2a3746 }
    .btn:active { transform: translateY(1px) }
    .btn.primary { background: linear-gradient(135deg, #1b6cff, #13c4ff); border: none; color: #061018 }
    .btn.good { background: linear-gradient(135deg, #17eaa4, #39e3ff); border: none; color: #041012 }
    .btn.danger { background: #1f0e12; border: 1px solid #3e1b22; color: #ffb4b4 }
    .grid { display: grid; grid-template-columns: 2fr 1fr; gap: 16px; margin-top: 16px }
    .panel { padding: 14px }
    .title { font-size: 18px; font-weight: 700; margin: 0 0 6px }
    .hint { font-size: 12px; color: var(--muted) }
    .linkbox {
      background: #0c131b; border: 1px dashed #2a3746; padding: 10px 12px; border-radius: 12px; word-break: break-all;
      display: flex; align-items: center; justify-content: space-between; gap: 10px;
    }
    code.preview {
      display: block; white-space: pre; overflow: auto; font-family: var(--mono); font-size: 13px; padding: 12px;
      background: #0b1219; border: 1px solid #192534; border-radius: 12px;
    }
    .pill {
      display: inline-flex; align-items: center; gap: 8px; background: #0e1620; border: 1px solid #213042;
      padding: 8px 10px; border-radius: 999px; font-size: 12px; color: var(--muted)
    }
    .footer { margin-top: 28px; color: var(--muted); font-size: 12px; text-align: center }
    .badge { padding: 2px 8px; border-radius: 999px; background: #102231; border: 1px solid #203449; color: var(--accent) }
    .hidden { display: none !important }
    /* Very light “syntax” tinting for Lua & JS keywords (client side only) */
    .kw { color: #79b8ff } .fn { color: #7af0b7 } .num { color: #ffd479 } .str { color: #ffa657 }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div class="brand">
        <div class="logo">P</div>
        <div>
          <div>PasteLite</div>
          <div class="muted">Minimal self-hosted pastebin (localStorage demo)</div>
        </div>
      </div>
      <div class="row">
        <span class="pill"><span class="badge">Raw mode</span> opens a plain-text tab</span>
      </div>
    </header>

    <div class="card">
      <div class="toolbar">
        <div class="row" style="flex:1">
          <input id="title" class="input" placeholder="Optional title (e.g., main.lua)" />
        </div>
        <div class="row">
          <button id="newBtn" class="btn">New</button>
          <button id="saveBtn" class="btn primary">Save Paste</button>
          <button id="copyBtn" class="btn good">Copy Raw</button>
          <button id="openRawBtn" class="btn">Open Raw</button>
          <button id="deleteBtn" class="btn danger">Delete</button>
        </div>
      </div>
      <textarea id="editor" spellcheck="false" placeholder="Paste your code here..."></textarea>
    </div>

    <div class="grid">
      <section class="card panel">
        <h3 class="title">Share links</h3>
        <div class="hint">Pretty view shows this page with the paste preloaded. Raw opens a plain-text tab via Blob (no HTML).</div>
        <div style="height: 10px"></div>
        <div class="linkbox">
          <div>
            <div class="muted">Pretty view</div>
            <div id="prettyUrl">—</div>
          </div>
          <button id="copyPretty" class="btn">Copy</button>
        </div>
        <div style="height: 10px"></div>
        <div class="linkbox">
          <div>
            <div class="muted">Raw (Blob URL)</div>
            <div id="rawUrl">—</div>
          </div>
          <button id="copyRawLink" class="btn">Copy</button>
        </div>
      </section>

      <aside class="card panel">
        <h3 class="title">Preview (read-only)</h3>
        <div class="hint">Tiny client syntax tinting for Lua/JS keywords.</div>
        <div id="preview" class="muted" style="margin-top:8px">
          <code class="preview">// Your code preview will appear here…</code>
        </div>
      </aside>
    </div>

    <p class="footer">
      This demo stores pastes in your browser’s <strong>localStorage</strong>. For production, add a backend and a <code>/raw/:id</code> route that sets <code>Content-Type: text/plain</code>.
    </p>
  </div>

  <script>
    // --- Utilities -----------------------------------------------------------
    const $ = (sel) => document.querySelector(sel);
    const storageKey = "pastelite.pastes.v1";
    const byId = () => JSON.parse(localStorage.getItem(storageKey) || "{}");
    const saveAll = (obj) => localStorage.setItem(storageKey, JSON.stringify(obj));
    const shortId = () => crypto.getRandomValues(new Uint8Array(6)).reduce((s,b)=>s+("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789")[b%62],"");

    function setPreview(code) {
      // super light tinting for Lua/JS-like keywords
      const safe = code.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
      const kw = /\b(function|local|end|return|if|then|else|for|while|do|repeat|until|true|false|nil|const|let|var)\b/g;
      const fn = /\b([a-zA-Z_][a-zA-Z0-9_]*)\s*(?=\()/g;
      const num = /\b(\d+(\.\d+)?)\b/g;
      const str = /(['"`])(.*?)\1/g;
      const highlighted = safe
        .replace(str, (m)=>`<span class="str">${m}</span>`)
        .replace(kw, (m)=>`<span class="kw">${m}</span>`)
        .replace(num, (m)=>`<span class="num">${m}</span>`)
        .replace(fn, (m)=>`<span class="fn">${m}</span>`);
      $("#preview").innerHTML = `<code class="preview">${highlighted || "// Your code preview will appear here…"}</code>`;
    }

    function buildPrettyUrl(id) {
      const u = new URL(location.href);
      u.searchParams.set("id", id);
      u.searchParams.delete("raw"); // pretty mode
      return u.toString();
    }

    function buildRawBlobUrl(code) {
      const blob = new Blob([code], { type: "text/plain;charset=utf-8" });
      return URL.createObjectURL(blob);
    }

    function loadFromQuery() {
      const id = new URLSearchParams(location.search).get("id");
      if (!id) return null;
      const all = byId();
      return all[id] ? { id, ...all[id] } : null;
    }

    function setLinks(id, code) {
      $("#prettyUrl").textContent = id ? buildPrettyUrl(id) : "—";
      $("#rawUrl").textContent    = code ? buildRawBlobUrl(code) : "—";
    }

    function notify(msg) {
      const to = document.createElement("div");
      to.textContent = msg;
      to.style.cssText = "position:fixed;bottom:20px;right:20px;background:#0e1621;border:1px solid #213042;padding:10px 12px;border-radius:12px;color:#cfe7ff;box-shadow:0 8px 24px rgba(0,0,0,.4);z-index:9999";
      document.body.appendChild(to);
      setTimeout(()=>to.remove(), 1600);
    }

    // --- State & Events ------------------------------------------------------
    let currentId = null;

    const titleEl = $("#title");
    const editorEl = $("#editor");

    // live preview
    editorEl.addEventListener("input", () => {
      setPreview(editorEl.value);
      if (currentId) setLinks(currentId, editorEl.value);
    });

    // New paste
    $("#newBtn").addEventListener("click", () => {
      currentId = null;
      titleEl.value = "";
      editorEl.value = "";
      setPreview("");
      setLinks(null, "");
      history.replaceState({}, "", location.pathname); // clear ?id
    });

    // Save paste
    $("#saveBtn").addEventListener("click", () => {
      const all = byId();
      const id = currentId || shortId();
      all[id] = { title: titleEl.value || "", code: editorEl.value || "" , ts: Date.now() };
      saveAll(all);
      currentId = id;
      setLinks(id, editorEl.value);
      history.replaceState({}, "", buildPrettyUrl(id));
      notify("Saved ✓");
    });

    // Copy raw code
    $("#copyBtn").addEventListener("click", async () => {
      await navigator.clipboard.writeText(editorEl.value || "");
      notify("Raw copied to clipboard");
    });

    // Open raw in new tab (Blob URL)
    $("#openRawBtn").addEventListener("click", () => {
      const rawUrl = buildRawBlobUrl(editorEl.value || "");
      window.open(rawUrl, "_blank", "noopener,noreferrer");
    });

    // Delete
    $("#deleteBtn").addEventListener("click", () => {
      if (!currentId) { notify("Nothing to delete"); return; }
      const all = byId();
      delete all[currentId];
      saveAll(all);
      notify("Deleted");
      $("#newBtn").click();
    });

    // Copy link buttons
    $("#copyPretty").addEventListener("click", async () => {
      const txt = $("#prettyUrl").textContent.trim();
      if (txt !== "—") { await navigator.clipboard.writeText(txt); notify("Pretty link copied"); }
    });
    $("#copyRawLink").addEventListener("click", async () => {
      const txt = $("#rawUrl").textContent.trim();
      if (txt !== "—") { await navigator.clipboard.writeText(txt); notify("Raw link (Blob) copied"); }
    });

    // Initial load (from ?id)
    (function init() {
      const loaded = loadFromQuery();
      if (loaded) {
        currentId = loaded.id;
        titleEl.value = loaded.title || "";
        editorEl.value = loaded.code || "";
      } else {
        // starter tip
        editorEl.value = `-- PasteLite demo\n-- Save, then share Pretty or open Raw.\n\nprint("hello from pastelite")\n\n-- Roblox example once you host a real /raw/:id endpoint:\n-- loadstring(game:HttpGet("https://yourhost/raw/ABCDEFG"))()`;
      }
      setPreview(editorEl.value);
      setLinks(currentId, editorEl.value);
    })();
  </script>
</body>
</html>
